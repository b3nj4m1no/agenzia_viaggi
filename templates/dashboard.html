<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - SunTravel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        .carousel-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin: 0 auto 2.5rem auto;
        }
        .carousel-slide {
            display: none;
            transition: opacity 0.5s;
        }
        .carousel-slide.active {
            display: block;
        }
        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: #2563eb;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            opacity: 0.85;
        }
        .carousel-arrow.left { left: 0.5rem; }
        .carousel-arrow.right { right: 0.5rem; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Navbar -->
    <nav class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <i class="fas fa-sun text-2xl mr-2"></i>
                <span class="font-bold text-xl">SunTravel</span>
            </div>
            <div class="flex items-center space-x-2">
                <span class="flex items-center px-4 py-2 rounded bg-blue-700 ml-2">
                    <i class="fas fa-user-circle text-xl mr-2"></i>
                    {{ current_user.username }}
                </span>
                <a href="/logout" class="px-4 py-2 rounded hover:bg-blue-700 ml-2">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-10 flex flex-col items-center">

        <!-- Carousel Offerte -->
        <div class="carousel-container mb-10 w-full">
            <button class="carousel-arrow left" onclick="plusSlide(-1)"><i class="fas fa-chevron-left"></i></button>
            <button class="carousel-arrow right" onclick="plusSlide(1)"><i class="fas fa-chevron-right"></i></button>
            {% for offerta in offerte %}
            <div class="carousel-slide {% if loop.index0 == 0 %}active{% endif %} bg-white rounded-lg shadow-lg p-8 text-center mx-auto">
                <h2 class="text-3xl font-bold text-blue-700 mb-2">{{ offerta.nome }}</h2>
                <p class="text-lg mb-2">{{ offerta.descrizione }}</p>
                <p class="mb-2"><b>Destinazione:</b> {{ offerta.destinazione }}</p>
                <p class="mb-2"><b>Sconto:</b> <span class="text-green-700 font-bold">{{ offerta.sconto_percentuale }}%</span></p>
                <p class="text-sm text-gray-500">Valida fino al {{ offerta.scadenza }}</p>
            </div>
            {% endfor %}
        </div>
        <script>
            let slideIndex = 0;
            const slides = document.getElementsByClassName('carousel-slide');
            function showSlide(n) {
                slideIndex = (n + slides.length) % slides.length;
                for (let i = 0; i < slides.length; i++) {
                    slides[i].classList.remove('active');
                }
                slides[slideIndex].classList.add('active');
            }
            function plusSlide(n) {
                showSlide(slideIndex + n);
            }
            // Mostra la prima slide all'avvio
            showSlide(0);
        </script>
        <!-- Fine Carousel -->

        <!-- Riepilogo Recensioni -->
        {% if riepilogo_recensioni %}
        <div class="bg-white rounded shadow p-6 mb-10 w-full max-w-2xl">
            <h3 class="text-xl font-bold mb-4 text-blue-800 text-center">Riepilogo Recensioni Mete Turistiche</h3>
            <table class="min-w-full text-center">
                <thead>
                    <tr>
                        <th class="py-2 px-4 text-center">Destinazione</th>
                        <th class="py-2 px-4 text-center">Media Voto</th>
                        <th class="py-2 px-4 text-center">NÂ° Recensioni</th>
                        <th class="py-2 px-4 text-center"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in riepilogo_recensioni %}
                    <tr class="border-t">
                        <td class="py-2 px-4">{{ r.destinazione }}</td>
                        <td class="py-2 px-4 text-yellow-600 font-bold">{{ r.media }}/5</td>
                        <td class="py-2 px-4">{{ r.num }}</td>
                        <td class="py-2 px-4">
                            <a href="{{ url_for('recensioni_destinazione', destinazione=r.destinazione) }}" class="text-blue-600 hover:underline">Vedi dettagli</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Azioni principali -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-4xl">
            <a href="{{ url_for('nuova_prenotazione') }}" class="block bg-white rounded shadow p-8 text-center hover:bg-blue-50 transition">
                <i class="fas fa-plus-circle text-4xl text-blue-600 mb-4"></i>
                <h3 class="text-xl font-bold mb-2">Nuova Prenotazione</h3>
                <p>Crea una nuova prenotazione di viaggio</p>
            </a>
            <a href="{{ url_for('storico') }}" class="block bg-white rounded shadow p-8 text-center hover:bg-blue-50 transition">
                <i class="fas fa-history text-4xl text-blue-600 mb-4"></i>
                <h3 class="text-xl font-bold mb-2">Storico Prenotazioni</h3>
                <p>Visualizza e scarica le tue prenotazioni passate</p>
            </a>
        </div>
    </div>
</body>
</html>